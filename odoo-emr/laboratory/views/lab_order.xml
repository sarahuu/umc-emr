<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_lab_order_form" model="ir.ui.view">
        <field name="name">lab.order.form</field>
        <field name="model">lab.order</field>
        <field name="arch" type="xml">
            <form string="Lab Order">
                <sheet>
                    <group>
                        <field name="name" readonly="1"/>
                        <field name="patient_id"/>
                        <field name="ordered_by" readonly="1"/>
                    </group>
                    <notebook>
                        <page string="Tests">
                            <field name="line_ids">
                                <list editable="bottom">
                                    <field name="test_type_id"/>
                                    <field name="reference_number"/>
                                    <field name="state" readonly="1"/>
                                    <button name="confirm_order" string="Confirm Order" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                                    <button name="action_view_results" string="View/Add Results" type="object" class="oe_highlight" invisible="state == 'draft'"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="view_lab_order_line_form" model="ir.ui.view">
        <field name="name">lab.order.line.form</field>
        <field name="model">lab.order.line</field>
        <field name="arch" type="xml">
            <form string="Lab Order Line" create="0">
                <header>
                    <button name="accept_order" string="Accept Order" type="object" class="oe_highlight" invisible="state != 'requested'"/>
                    <button name="reject_order" string="Reject Order" type="object" class="oe_highlight" invisible="state in ['draft','completed','rejected']"/>
                    <button name="mark_completed" string="Complete Order" type="object" class="oe_highlight" invisible="state != 'accepted'"/>
                    <field name="state" widget="statusbar" nolabel="1"/>
                </header>
                <sheet>
                        <div class="oe_title">
                            <label for="name" string="Laboratory Order Reference"/>
                            <h1>
                                <div class="d-flex">
                                    <field class="text-break" name="name" readonly='1'/>
                                </div>
                            </h1>
                        </div>
                    <group>
                        <group>
                            <field name="patient_id" readonly="1"/>
                            <field name="patient_name" readonly="1"/>
                            <field name="test_type_id" readonly="1"/>
                            <field name="reference_number"/>
                            <field name="accepted_by" readonly="1" invisible="state != 'accepted'"/>
                            <field name="rejected_by" readonly="1" invisible="state != 'rejected'"/>
                            <field name="result_id" invisible="1"/>

                        </group>
                        <group>
                            <field name="notes"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Parameter Results" invisible="state in ['draft','requested','rejected']">
                            <field name="parameter_result_ids" context="{'default_result_id': result_id}">
                                <list editable="bottom" >
                                    <field name="result_id" column_invisible="1"/>
                                    <field name="parameter_id"/>
                                    <field name="parameter_type"/>
                                    <field name="value_numeric" invisible="parameter_type != 'numeric'"/>
                                    <field name="value_text" invisible="parameter_type != 'text'"/>
                                    <field name="value_select" invisible="parameter_type != 'select'"/>
                                    <field name="unit"/>
                                    <field name="is_abnormal"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="view_lab_order_list" model="ir.ui.view">
        <field name="name">lab.order.list</field>
        <field name="model">lab.order</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="patient_id"/>
                <field name="ordered_by"/>
            </list>
        </field>
    </record>
    <record id="view_lab_order_line_list" model="ir.ui.view">
        <field name="name">lab.order.line.list</field>
        <field name="model">lab.order.line</field>
        <field name="arch" type="xml">
            <list create="0">
                <field name="name"/>
                <field name="test_type_id"/>
                <field name="reference_number"/>
                <field name="state" widget="badge" decoration-danger="state == 'rejected'" decoration-success="state == 'completed'" decoration-warning="state in ['requested','accepted']"/>
            </list>
        </field>
    </record>

    <record id="view_lab_order_line_search" model="ir.ui.view">
        <field name="name">lab.order.line.search</field>
        <field name="model">lab.order.line</field>
        <field name="arch" type="xml">
            <search>
                <field name="patient_id"/>
                <filter string="Lab Orders" name="state" domain="[('state','!=','draft')]"/>
            </search>
        </field>
    </record>

    <record id="action_lab_order" model="ir.actions.act_window">
        <field name="name">Lab Orders</field>
        <field name="res_model">lab.order</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first lab order
            </p>
        </field>
    </record>
    <record id="action_lab_order_line" model="ir.actions.act_window">
        <field name="name">Lab Order Lines</field>
        <field name="res_model">lab.order.line</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first lab order
            </p>
        </field>
    </record>
</odoo>
